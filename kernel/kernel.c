// ------------------------------------------------------------------------------------------------
// kernel.c
// ------------------------------------------------------------------------------------------------

#include "format.h"

#define VIDMEM_BASE 0xb8000

// ------------------------------------------------------------------------------------------------
static void clear()
{
    volatile u64* p = (volatile u64*)VIDMEM_BASE;
    for (int i = 0; i < 500; ++i)
    {
        *p++ = 0x1f201f201f201f20;
    }
}

// ------------------------------------------------------------------------------------------------
static void print(const char* s, uint line)
{
    volatile u8* p = (volatile u8*)VIDMEM_BASE;

    p += line * 80 * 2;

    while (*s)
    {
        *p++ = *s++;
        *p++ = 0x1f;
    }
}

// ------------------------------------------------------------------------------------------------
int kmain()
{
    char buf[32];

    clear();
    snprintf(buf, sizeof(buf), "Hello World %d!", 3141);
    print(buf, 0);

    for (;;)
    {
    }

    return 0;
}
